#!/usr/bin/env python
# -*- coding: utf-8 -*-
# Date       : 2015-05-26 11:26:30
# Author     : 陈小雪
# E-mail     : shell_chen@yeah.net
# Version    : 1.0.1

import sys
import os
import re
import logging
def load(path):
    sys.path.insert(0, path)

    modes = os.listdir( path )
    infos = __load(modes)

    del sys.path[0]
    return infos


def __load(modes):
    mode_infos = {}
    for mode in modes:
        if not mode.endswith('.py'):
            continue

        try:
            modename = mode[0:-3]
            mode = __import__(modename)
            mode_info = __mode_init(mode)
            if mode_info:
                mode_infos[modename] = mode_info
            logging.info("load plugin: %s" % modename)
        except IOError, why:
             logging.error("Load plugin Error:%s:%s" %( mode, why))
    return mode_infos

def __mode_init(mode):

    attr = "name"
    if not hasattr(mode, attr):
        logging.error("mode init:%s not hasattr [%s]" % (mode, attr))
        return ( )
    name = getattr(mode, attr)

    attr = "urls"
    if not hasattr(mode, attr):
        logging.error("mode init:%s not hasattr [%s]"% (mode,attr))
        return ( )

    urls = getattr(mode, attr)

    return (mode, name, urls)
